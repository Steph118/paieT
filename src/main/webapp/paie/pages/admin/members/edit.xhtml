<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html
    xmlns:ui="jakarta.faces.facelets"
    xmlns:f="jakarta.faces.core"
    xmlns:p="http://primefaces.org/ui">
    <ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        template="/paie/templates/layout-edit.xhtml">

        <ui:define name="metadata">
            <f:metadata>
                <f:viewParam name="entityId" value="#{memberBean.entityId}"/>
                <f:viewAction action="#{memberBean.initEntity()}"/>
            </f:metadata>
        </ui:define>

        <ui:param name="crudBean" value="#{memberBean}"/>

        <ui:param name="fieldsTitle" value="#{msg['member']}"/>

        <ui:define name="list-title">
            #{msg['members.edit.title']}
        </ui:define>
        <ui:define name="breadCrumb">
            #{msg['members.breadCrumb']}
        </ui:define>
        <!--        <ui:insert name="fields">
                    <p:fieldset legend="#{fieldsTitle}">
                        <div class="form-grid grid ui-fluid">
                            <ui:insert name="fields-content"/>
                        </div>
                    </p:fieldset>
                </ui:insert>-->
        <ui:define name="fields">
            <p:fieldset legend="#{fieldsTitle}">
                <ui:fragment >
                    <p:fieldset id="addMember">
                        <div class="form-grid grid ui-fluid">
                            <div class="field sm:col-12 col-12 md:col-4 lg:col-4">
                                <p:outputLabel for="eglise" value="#{msg['entites.eglise.title']}"/>
                                <p:selectOneMenu id="eglise" class="w-full" filterMatchMode="startsWith"
                                                 filterNormalize="true" filter="true" filterPlaceholder="#{msg['search']}"
                                                 converter="omnifaces.SelectItemsConverter" required="true"
                                                 value="#{memberBean.entity.eglise}">
                                    <f:selectItem noSelectionOption="true" itemLabel="#{msg['choice-label']}"/>
                                    <f:selectItems value="#{memberBean.eglises}" itemValue="#{s}" var="s" itemLabel="#{s.label}"/>
                                    <p:ajax update="person"/>
                                </p:selectOneMenu>
                            </div>
                            <div class="field sm:col-12 col-12 md:col-4 lg:col-4">
                                <p:outputLabel for="dpt" value="#{msg['departement.title']}"/>
                                <p:selectOneMenu id="dpt" class="w-full" filterMatchMode="startsWith"
                                                 filterNormalize="true" filter="true" filterPlaceholder="#{msg['search']}"
                                                 converter="omnifaces.SelectItemsConverter"
                                                 value="#{memberBean.department}">
                                    <f:selectItem noSelectionOption="true" itemLabel="#{msg['choice-label']}"/>
                                    <f:selectItems value="#{memberBean.departments}" itemValue="#{s}" var="s" itemLabel="#{s.label}"/>
                                    <p:ajax update="person"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="field sm:col-12 col-12 md:col-4 lg:col-4">
                                <p:outputLabel for="sexe" value="#{msg['references.sexe.title']}"/>
                                <p:selectOneMenu id="sexe" class="w-full" filterMatchMode="startsWith"
                                                 filterNormalize="true" filter="true" filterPlaceholder="#{msg['search']}"
                                                 converter="omnifaces.SelectItemsConverter"
                                                 value="#{memberBean.sexe}">
                                    <f:selectItem noSelectionOption="true" itemLabel="#{msg['choice-label']}"/>
                                    <f:selectItems value="#{memberBean.sexes}" itemValue="#{s}" var="s" itemLabel="#{s.label}"/>
                                    <p:ajax update="person"/>
                                </p:selectOneMenu>
                            </div>

                            <!--                        <div class="field sm:col-12 col-12 md:col-6 lg:col-6">
                                                        <p:outputLabel for="person" value="# {msg['person.title']}"/>
                                                        <p:selectOneMenu id="person" class="w-full" filterMatchMode="startsWith"
                                                                         filterNormalize="true" filter="true" filterPlaceholder="# {msg['search']}"
                                                                         converter="omnifaces.SelectItemsConverter"
                                                                         dynamic="true"
                                                                         >
                                                            <f:selectItem noSelectionOption="true" itemLabel="# {msg['choice-label']}"/>
                                                            <f:selectItems value="# {memberBean.listPersons()}" itemValue="# {p}" var="p" itemLabel="# {p.getFullName()}"/>
                                                        </p:selectOneMenu>
                                                    </div>
                                                    <div class="field sm:col-12 col-12 md:col-6 lg:col-6">
                                                        <p:outputLabel value="# {msg['members.edit.nummember']}" for="numMember"/>
                                                        <p:inputText id="numMember" class="w-full"
                                                                     value="# {memberBean.entity.memberNumber}"
                                                                     disabled="true"/>
                                                    </div>-->
                            <div class="field col-12">
                                <p:outputLabel value="#{msg['person.title']}" for="person"/>
                                <p:autoComplete id="person" value="#{memberBean.entity.person}"
                                                converter="#{personConverter}" forceSelection="true"
                                                var="p" itemLabel="#{p.getFullName()}" itemValue="#{p}"
                                                completeMethod="#{memberBean.listPersons(query)}" required="true"
                                                />  

                            </div> 
                            <div class="p-2 field">
                                <p:commandButton value="addmember" icon="pi pi-plus" process="addMember" 
                                                 action="#{memberBean.addMemberToList()}"
                                                 update="membersData save eglise person dpt sexe"/>
                            </div>
                        </div>
                    </p:fieldset>
                </ui:fragment>
                <ui:fragment>
                    <p:fieldset class="mt-3" id="membersData">
                        <div class="form-grid grid ui-fluid">
                            <p:dataTable value="#{memberBean.members}" var="m" paginator="true"
                                         rowKey="#{m.person.id}" rows="5" id="data">
                                <p:column headerText="#{msg['members.edit.nummember']}">
                                    <p:outputLabel value="#{m.memberNumber}"/>
                                </p:column>
                                <p:column headerText="#{msg['person.title']}">
                                    <p:outputLabel value="#{m.person.fullName}"/>
                                </p:column>
                                <p:column headerText="#{msg['entites.eglise.title']}">
                                    <p:outputLabel value="#{m.eglise.label}"/>
                                </p:column>
                                <p:column headerText="OpÃ©rations" style="text-align: center">
                                    <div class="flex align-items-center justify-content-center">
                                        <ui:insert name="operations-btn">
                                            <p:tooltip value="#{msg['edit']}" for="editButton" position="top"/>
                                            <p:commandButton id="editButton" class="ui-button-primary m-1" 
                                                             update="membersData editForm:saveBtn editForm:addMember data" process="editButton" 
                                                             disabled="#{memberBean.updateIntoList}"
                                                             icon="fa fa-edit" action="#{memberBean.updateMemberToList(m)}"/>

                                            <p:tooltip value="#{msg['delete']}" for="deleteButton" position="top"/>
                                            <p:commandButton id="deleteButton" class="ui-button-danger m-1" 
                                                             update="membersData editForm:saveBtn editForm:addMember data" 
                                                             process="deleteButton"
                                                             icon="pi pi-trash" action="#{memberBean.removeMemberToList(m)}"/>
                                        </ui:insert>
                                    </div>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </p:fieldset> 
                </ui:fragment>
            </p:fieldset>
        </ui:define>

        <ui:define name="saveBtn">
            <p:commandButton id="save" value="#{msg['save.button']}" icon="fa fa-save"
                             class="ui-button-primary" process="membersData"
                             actionListener="#{memberBean.beforeSave()}"
                             action="#{memberBean.save()}" 
                             disabled="#{empty memberBean.members}"
                             rendered="#{!memberBean.isUpdating()}">
                <p:confirm header="#{msg['confirmer.label']}" icon="ui-icon-alert"
                           message="#{msg['confirmer.placeholder']}"/>
            </p:commandButton>
        </ui:define>
    </ui:composition>
</html>

